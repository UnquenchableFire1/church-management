<!doctype html>
<html>
	<head>
		<meta charset='utf-8'>
		<meta name='viewport' content='width=device-width,initial-scale=1'>
		<title>Login</title>
		<link rel='stylesheet' href='styles.css'>
	</head>
	<body>
		<header class="site-header">
			<div class="nav">
				<div class="brand"><div class="logo">CP</div><div>The Church of Pentecost</div></div>
							<nav class="nav-links" aria-hidden="true" role="menu">
								<button class="nav-close" aria-label="Close menu">✕</button>
								<a href="/" role="menuitem">Home</a>
								<a href="/register.html" role="menuitem">Register</a>
								<button id="memberLogout" class="btn secondary" style="margin-left:16px">Logout</button>
							</nav>
						<button id="navToggle" class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">☰</button>
			</div>
		</header>
		<main class='container'>
			<div class='card' style='max-width:640px;margin:0 auto'>
				<script>
					// Helper to clear all fields
					function clearFields() {
						document.getElementById('email').value = '';
						document.getElementById('password').value = '';
						document.getElementById('username').value = '';
						document.getElementById('apass').value = '';
						document.getElementById('msg').innerText = '';
					}
					// On page load, clear all fields
					window.onload = clearFields;
					document.getElementById('memberBtn').onclick=_=>{
						document.getElementById('memberForm').style.display='block';
						document.getElementById('adminForm').style.display='none';
						clearFields();
					};
					document.getElementById('adminBtn').onclick=_=>{
						document.getElementById('memberForm').style.display='none';
						document.getElementById('adminForm').style.display='block';
						clearFields();
					};
					document.getElementById('mLogin').onclick=async ()=>{
						const res=await fetch('/api/auth/login',{ 
							method:'POST',
							headers:{'Content-Type':'application/json'},
							body: JSON.stringify({email:document.getElementById('email').value,password:document.getElementById('password').value})
						});
						const j=await res.json();
						if(res.ok){ localStorage.setItem('token', j.token); location='/'; }
						else document.getElementById('msg').innerText=j.message||'Error';
						clearFields();
					};
					document.getElementById('aLogin').onclick=async ()=>{
						const res=await fetch('/api/admin/login',{
							method:'POST',
							headers:{'Content-Type':'application/json'},
							body: JSON.stringify({username:document.getElementById('username').value,password:document.getElementById('apass').value})
						});
						const j=await res.json();
						if(res.ok){ localStorage.setItem('adminToken', j.token); location='/admin.html'; }
						else document.getElementById('msg').innerText=j.message||'Error';
						clearFields();
					};
					// Forgot password logic
					function showResetModal(type) {
						document.getElementById('resetModal').style.display = 'block';
						document.getElementById('resetMsg').innerText = '';
						if(type==='member') {
							document.getElementById('resetFields').innerHTML = "<input id='resetEmail' placeholder='Enter your email' style='width:100%'>";
						} else {
							document.getElementById('resetFields').innerHTML = "<input id='resetUsername' placeholder='Enter your username' style='width:100%'>";
						}
						document.getElementById('resetSend').onclick = async () => {
							let payload = {};
							if(type==='member') {
								const email = document.getElementById('resetEmail').value;
								if(!email) { document.getElementById('resetMsg').innerText = 'Please enter your email.'; return; }
								payload = { email };
							} else {
								const username = document.getElementById('resetUsername').value;
								if(!username) { document.getElementById('resetMsg').innerText = 'Please enter your username.'; return; }
								payload = { username };
							}
							// Send to backend (endpoint to be implemented)
							const res = await fetch(type==='member' ? '/api/auth/forgot-password' : '/api/admin/forgot-password', {
								method: 'POST',
								headers: { 'Content-Type': 'application/json' },
								body: JSON.stringify(payload)
							});
							if(res.ok) document.getElementById('resetMsg').innerText = 'Reset link sent! Check your email.';
							else document.getElementById('resetMsg').innerText = 'Failed to send reset link.';
						};
						document.getElementById('resetCancel').onclick = () => {
							document.getElementById('resetModal').style.display = 'none';
						};
					}
					document.getElementById('memberForgot').onclick = (e) => { e.preventDefault(); showResetModal('member'); };
					document.getElementById('adminForgot').onclick = (e) => { e.preventDefault(); showResetModal('admin'); };

					// mobile nav accessible script
					(function setupMobileNav(){
						const nav = document.querySelector('.nav-links');
						const toggle = document.getElementById('navToggle');
						if(!nav || !toggle) return;
						const closeBtn = nav.querySelector('.nav-close');
						const focusableSelector = 'a, button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';
						let lastFocus = null;
						function openNav(){
							nav.classList.add('open');
							nav.setAttribute('aria-hidden','false');
							toggle.setAttribute('aria-expanded','true');
							toggle.classList.add('open');
							lastFocus = document.activeElement;
							const first = nav.querySelector(focusableSelector);
							if(first) first.focus();
							document.addEventListener('keydown', trapTab);
							document.addEventListener('keydown', escClose);
						}
						function closeNav(){
							nav.classList.remove('open');
							nav.setAttribute('aria-hidden','true');
							toggle.setAttribute('aria-expanded','false');
							toggle.classList.remove('open');
							if(lastFocus) lastFocus.focus();
							document.removeEventListener('keydown', trapTab);
							document.removeEventListener('keydown', escClose);
						}
						function trapTab(e){
							if(e.key !== 'Tab') return;
							const focusables = Array.from(nav.querySelectorAll(focusableSelector)).filter(el=>!el.hasAttribute('disabled'));
							if(focusables.length===0){ e.preventDefault(); return; }
							const first = focusables[0], last = focusables[focusables.length-1];
							if(e.shiftKey){ if(document.activeElement === first){ e.preventDefault(); last.focus(); } }
							else { if(document.activeElement === last){ e.preventDefault(); first.focus(); } }
						}
						function escClose(e){ if(e.key === 'Escape') closeNav(); }
						toggle.addEventListener('click', ()=>{ if(nav.classList.contains('open')) closeNav(); else openNav(); });
						if(closeBtn) closeBtn.addEventListener('click', closeNav);
						nav.querySelectorAll('a, button').forEach(el=>{ el.addEventListener('click', ()=>{ if(el.tagName.toLowerCase()==='a') closeNav(); }); });
					})();
			</script>
						document.getElementById('resetSend').onclick = async () => {
							let payload = {};
							if(type==='member') {
								const email = document.getElementById('resetEmail').value;
								if(!email) { document.getElementById('resetMsg').innerText = 'Please enter your email.'; return; }
								payload = { email };
							} else {
								const username = document.getElementById('resetUsername').value;
								if(!username) { document.getElementById('resetMsg').innerText = 'Please enter your username.'; return; }
								payload = { username };
							}
							// Send to backend (endpoint to be implemented)
							const res = await fetch(type==='member' ? '/api/auth/forgot-password' : '/api/admin/forgot-password', {
								method: 'POST',
								headers: { 'Content-Type': 'application/json' },
								body: JSON.stringify(payload)
							});
							if(res.ok) document.getElementById('resetMsg').innerText = 'Reset link sent! Check your email.';
							else document.getElementById('resetMsg').innerText = 'Failed to send reset link.';
						};
						document.getElementById('resetCancel').onclick = () => {
							document.getElementById('resetModal').style.display = 'none';
						};
					}
					document.getElementById('memberForgot').onclick = (e) => { e.preventDefault(); showResetModal('member'); };
					document.getElementById('adminForgot').onclick = (e) => { e.preventDefault(); showResetModal('admin'); };
			</script>
			<script>
				document.getElementById('memberLogout').onclick = function() {
					localStorage.removeItem('token');
					window.location = '/login.html';
				};
				// Mobile nav toggle
				const navToggleBtn = document.getElementById('navToggle');
				if(navToggleBtn){
					navToggleBtn.addEventListener('click', ()=>{
						const nav = document.querySelector('.nav-links');
						if(nav) nav.classList.toggle('open');
					});
				}
			</script>
	</body>
</html>